{{ if .IsHome }}
<div id="disco-root" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 50; overflow: hidden; user-select: none;">
    </div>

<style>
    /* 核心动画 */
    @keyframes discoSpin {
        from { transform: translate(-50%, -50%) rotate(0deg); }
        to { transform: translate(-50%, -50%) rotate(360deg); }
    }
    @keyframes discoSpinReverse {
        from { transform: translate(-50%, -50%) rotate(360deg); }
        to { transform: translate(-50%, -50%) rotate(0deg); }
    }
    @keyframes discoPulse {
        /* 调整了不透明度范围：从 0.3->0.8 提升到了 0.6->1.0 */
        /* 这样整体看起来会更亮、更实 */
        0%, 100% { opacity: 0.6; transform: translate(-50%, -50%) scale(0.95); }
        50% { opacity: 1; transform: translate(-50%, -50%) scale(1.05); }
    }

    /* 容器样式 */
    .disco-layer-container {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 200vmax;
        height: 200vmax;
        transform-origin: center center;
        will-change: transform;
    }
    
    .disco-spot {
        position: absolute;
        border-radius: 50%;
        transform-origin: center center;
        mix-blend-mode: screen; 
    }
</style>

<script>
(function() {
    const root = document.getElementById('disco-root');
    if (!root) return;

    // 1. 梦幻配色表 (改为 RGB 格式，方便代码动态控制透明度)
    const dreamyColorsRGB = [
        '186, 225, 255', // 梦幻蓝
        '255, 223, 211', // 蜜桃粉
        '211, 255, 206', // 薄荷绿
        '224, 187, 228', // 薰衣草紫
    ];

    // 2. 层级配置
    const layerConfigs = [
        { radiusMin: 2,  radiusMax: 15,  count: 18, sizeBase: 12, duration: 50, reverse: false, blur: 2 },
        { radiusMin: 15, radiusMax: 35,  count: 25, sizeBase: 15, duration: 70, reverse: true,  blur: 3 },
        { radiusMin: 35, radiusMax: 60,  count: 40, sizeBase: 20, duration: 60, reverse: false, blur: 4 },
        { radiusMin: 60, radiusMax: 90,  count: 55, sizeBase: 26, duration: 85, reverse: true,  blur: 6 },
        { radiusMin: 90, radiusMax: 130, count: 70, sizeBase: 32, duration: 75, reverse: false, blur: 8 },
    ];

    const random = (min, max) => Math.random() * (max - min) + min;

    // 3. 生成逻辑
    layerConfigs.forEach((config, layerIdx) => {
        const layerDiv = document.createElement('div');
        layerDiv.className = 'disco-layer-container';
        
        const animName = config.reverse ? 'discoSpinReverse' : 'discoSpin';
        layerDiv.style.animation = `${animName} ${config.duration}s linear infinite`;
        
        for (let i = 0; i < config.count; i++) {
            const spot = document.createElement('div');
            spot.className = 'disco-spot';

            // --- 位置计算 ---
            const angle = Math.random() * Math.PI * 2;
            const dist = random(config.radiusMin, config.radiusMax);
            
            const left = 50 + (Math.cos(angle) * dist) / 2; 
            const top = 50 + (Math.sin(angle) * dist) / 2;

            // --- 尺寸与圆度 ---
            const w = config.sizeBase + Math.random() * 10;
            const normalizedDist = Math.min(dist / 140, 1); // 0(中心) -> 1(边缘)
            
            // 越靠近中心越圆
            const baseRoundness = 1.0; 
            const distanceStretch = normalizedDist * 0.6; // 拉伸幅度减小，保持较圆
            const curvature = baseRoundness + distanceStretch;
            const h = w * curvature;

            // --- 核心修改：基于距离的透明度算法 ---
            // 逻辑：中心非常实 (0.9), 边缘比较虚 (0.4)
            // 公式：基础透明度 = 0.9 - (距离 * 0.5)
            const opacityBase = 0.95 - (normalizedDist * 0.55);

            // --- 颜色 ---
            const isColored = Math.random() > 0.8;
            let colorString;
            
            if (isColored) {
                // 彩色光斑
                const rgb = dreamyColorsRGB[Math.floor(Math.random() * dreamyColorsRGB.length)];
                // 彩色稍微透一点点，更有玻璃感
                colorString = `rgba(${rgb}, ${opacityBase * 0.9})`; 
            } else {
                // 白色光斑
                // 确保白色光斑足够亮
                colorString = `rgba(255, 255, 255, ${opacityBase})`;
            }

            // --- 应用样式 ---
            spot.style.width = w + 'px';
            spot.style.height = h + 'px';
            spot.style.left = left + '%';
            spot.style.top = top + '%';
            
            // 渐变调整：
            // at 45% 45%: 光源稍微偏一点点，更立体
            // ${colorString} 25%: 实心区域扩大到 25%，之前是 0%，所以现在中心更实
            spot.style.background = `radial-gradient(ellipse at 45% 45%, ${colorString} 25%, rgba(0,0,0,0) 70%)`;
            
            const rotation = (angle * 180) / Math.PI + 90;
            spot.style.transform = `translate(-50%, -50%) rotate(${rotation}deg)`;
            spot.style.filter = `blur(${config.blur}px)`;
            
            spot.style.animation = `discoPulse ${4 + Math.random() * 3}s ease-in-out infinite alternate`;
            spot.style.animationDelay = `${Math.random() * 5}s`;

            layerDiv.appendChild(spot);
        }

        root.appendChild(layerDiv);
    });
})();
</script>

{{ end }}