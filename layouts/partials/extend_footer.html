{{ if not .IsPage }}
<div id="disco-root" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 50; overflow: hidden; user-select: none;"></div>

<style>
    /* Ê†∏ÂøÉÂä®Áîª */
    @keyframes discoSpin {
        from { transform: translate(-50%, -50%) rotate(0deg); }
        to { transform: translate(-50%, -50%) rotate(360deg); }
    }
    @keyframes discoSpinReverse {
        from { transform: translate(-50%, -50%) rotate(360deg); }
        to { transform: translate(-50%, -50%) rotate(0deg); }
    }
    @keyframes discoPulse {
        0%, 100% { opacity: 0.5; transform: translate(-50%, -50%) scale(0.9); }
        50% { opacity: 0.9; transform: translate(-50%, -50%) scale(1.1); }
    }

    /* ÂÆπÂô®Ê†∑Âºè */
    .disco-layer-container {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 200vmax;
        height: 200vmax;
        transform-origin: center center;
        will-change: transform;
    }
    
    .disco-spot {
        position: absolute;
        border-radius: 50%;
        transform-origin: center center;
        mix-blend-mode: screen; 
    }
</style>

<script>
(function() {
    const root = document.getElementById('disco-root');
    if (!root) return;

    // üé® ÊûÅ‰πêËø™ÊñØÁßë¬∑‰ΩéÈ•±ÂíåÁâπË∞ÉÁâà (‰øùÊåÅ‰∏çÂèò)
    const subtleVibeColorsRGB = [
        '120, 140, 170', // Èò¥Èõ®ÁÅ∞Ëìù
        '210, 195, 160', // ÁæäÁöÆÁ∫∏ÈªÑ
        '160, 150, 180', // Â∞òÂüÉÊ∑°Á¥´
        '140, 165, 160', // Ëã¶ËâæÈÖíÁÅ∞Áªø
    ];

    // Â±ÇÁ∫ßÈÖçÁΩÆ (Á®çÂæÆÂáèÂ∞è‰∫ÜÂÜÖÂ±ÇÁöÑÂ∞∫ÂØ∏Âü∫Êï∞Ôºå‰∏∫‰∫ÜÂØπÊØîÂá∫Â§ñÂ±ÇÁöÑÂ§ß)
    const layerConfigs = [
        { radiusMin: 5,  radiusMax: 20,  count: 20, sizeBase: 8,  duration: 45, reverse: false, blur: 2 },
        { radiusMin: 20, radiusMax: 45,  count: 30, sizeBase: 12, duration: 65, reverse: true,  blur: 3 },
        { radiusMin: 45, radiusMax: 75,  count: 45, sizeBase: 16, duration: 55, reverse: false, blur: 4 },
        { radiusMin: 75, radiusMax: 110, count: 60, sizeBase: 22, duration: 80, reverse: true,  blur: 6 },
        { radiusMin: 110,radiusMax: 160, count: 80, sizeBase: 28, duration: 70, reverse: false, blur: 8 },
    ];

    const random = (min, max) => Math.random() * (max - min) + min;

    layerConfigs.forEach((config) => {
        const layerDiv = document.createElement('div');
        layerDiv.className = 'disco-layer-container';
        
        const animName = config.reverse ? 'discoSpinReverse' : 'discoSpin';
        layerDiv.style.animation = `${animName} ${config.duration}s linear infinite`;
        
        for (let i = 0; i < config.count; i++) {
            const spot = document.createElement('div');
            spot.className = 'disco-spot';

            // --- ‰ΩçÁΩÆ ---
            const angle = Math.random() * Math.PI * 2;
            const dist = random(config.radiusMin, config.radiusMax);
            const left = 50 + (Math.cos(angle) * dist) / 2; 
            const top = 50 + (Math.sin(angle) * dist) / 2;

            // --- Ê†∏ÂøÉ‰øÆÊîπÂå∫ÔºöÂ∞∫ÂØ∏‰∏éÂΩ¢Áä∂ ---
            
            // 1. ËÆ°ÁÆóË∑ùÁ¶ªÁ≥ªÊï∞ (0Âú®‰∏≠ÂøÉ, 1Âú®ËæπÁºò)
            const normalizedDist = Math.min(dist / 150, 1);

            // 2. ËÆ°ÁÆóÂÆΩÂ∫¶ (Width) - ÂºïÂÖ•Ë∑ùÁ¶ªÊîæÂ§ßÁ≥ªÊï∞
            // ËæπÁºòÁöÑÂÖâÊñëÂü∫Á°ÄÂ§ßÂ∞èÊòØ‰∏≠ÂøÉÁöÑ 2.5 ÂÄçÂ∑¶Âè≥
            const baseWidth = config.sizeBase + Math.random() * 8;
            const sizeMultiplier = 1.0 + (normalizedDist * 1.5); 
            const w = baseWidth * sizeMultiplier;

            // 3. ËÆ°ÁÆóÊãâ‰º∏ÊØî (Curvature) - Â§ßÂπÖÂ¢ûÂä†ËæπÁºòÊãâ‰º∏
            // ‰∏≠ÂøÉ‰øùÊåÅ 1.5ÂÄçÂæÆÊ§≠ÂúÜ
            // ËæπÁºòÊãâ‰º∏Â¢ûÂä† 4.0ÂÄçÔºåÊÄªÊõ≤ÁéáÂèØËææ 5.5ÂÄç (ÈùûÂ∏∏ÁªÜÈïø)
            const baseElongation = 1.5; 
            const distanceStretch = normalizedDist * 4.0; 
            const curvature = baseElongation + distanceStretch;
            
            // 4. ËÆ°ÁÆóÈ´òÂ∫¶ (Height)
            const h = w * curvature;

            // --- È¢úËâ≤‰∏éÈÄèÊòéÂ∫¶ (‰øùÊåÅ‰∏çÂèò) ---
            const opacityBase = 0.9 - (normalizedDist * 0.4);

            const isColored = Math.random() > 0.65; 
            let colorString;
            
            if (isColored) {
                const rgb = subtleVibeColorsRGB[Math.floor(Math.random() * subtleVibeColorsRGB.length)];
                colorString = `rgba(${rgb}, ${opacityBase * 0.9})`; 
            } else {
                colorString = `rgba(255, 250, 235, ${opacityBase * 0.8})`;
            }

            // --- Ê†∑ÂºèÂ∫îÁî® ---
            spot.style.width = w + 'px';
            spot.style.height = h + 'px';
            spot.style.left = left + '%';
            spot.style.top = top + '%';
            
            spot.style.background = `radial-gradient(ellipse at 50% 50%, ${colorString} 20%, rgba(0,0,0,0) 65%)`;
            
            // ÊóãËΩ¨
            const rotation = (angle * 180) / Math.PI + 90;
            spot.style.transform = `translate(-50%, -50%) rotate(${rotation}deg)`;
            spot.style.filter = `blur(${config.blur}px)`;
            
            // Âä®Áîª
            spot.style.animation = `discoPulse ${4 + Math.random() * 3}s ease-in-out infinite alternate`;
            spot.style.animationDelay = `${Math.random() * 5}s`;

            layerDiv.appendChild(spot);
        }

        root.appendChild(layerDiv);
    });
})();
</script>

{{ end }}