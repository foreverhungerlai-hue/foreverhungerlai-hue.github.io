{{ if not .IsPage }}
<div id="disco-root" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 50; overflow: hidden; user-select: none;"></div>

<style>
    /* 核心动画 */
    @keyframes discoSpin {
        from { transform: translate(-50%, -50%) rotate(0deg); }
        to { transform: translate(-50%, -50%) rotate(360deg); }
    }
    @keyframes discoSpinReverse {
        from { transform: translate(-50%, -50%) rotate(360deg); }
        to { transform: translate(-50%, -50%) rotate(0deg); }
    }
    @keyframes discoPulse {
        0%, 100% { opacity: 0.5; transform: translate(-50%, -50%) scale(0.9); }
        50% { opacity: 0.9; transform: translate(-50%, -50%) scale(1.1); }
    }

    /* 容器样式 */
    .disco-layer-container {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 200vmax;
        height: 200vmax;
        transform-origin: center center;
        will-change: transform;
    }
    
    .disco-spot {
        position: absolute;
        border-radius: 50%;
        transform-origin: center center;
        mix-blend-mode: screen; 
    }
</style>

<script>
(function() {
    const root = document.getElementById('disco-root');
    if (!root) return;

    // 1. 新配色表 (克莱因蓝 / 明黄 / 霓虹紫 / 荧光绿)
    const vividColorsRGB = [
        '0, 47, 167',    // 克莱因蓝 (Klein Blue) - 深邃
        '255, 235, 59',  // 赛博黄 - 亮眼
        '138, 43, 226',  // 蓝紫色 (BlueViolet) - 神秘
        '50, 205, 50',   // 柠檬绿 (LimeGreen) - 活力
    ];

    // 2. 层级配置
    const layerConfigs = [
        { radiusMin: 5,  radiusMax: 20,  count: 20, sizeBase: 10, duration: 45, reverse: false, blur: 2 },
        { radiusMin: 20, radiusMax: 45,  count: 30, sizeBase: 14, duration: 65, reverse: true,  blur: 3 },
        { radiusMin: 45, radiusMax: 75,  count: 45, sizeBase: 18, duration: 55, reverse: false, blur: 4 },
        { radiusMin: 75, radiusMax: 110, count: 60, sizeBase: 24, duration: 80, reverse: true,  blur: 6 },
        { radiusMin: 110,radiusMax: 150, count: 80, sizeBase: 30, duration: 70, reverse: false, blur: 8 },
    ];

    const random = (min, max) => Math.random() * (max - min) + min;

    layerConfigs.forEach((config) => {
        const layerDiv = document.createElement('div');
        layerDiv.className = 'disco-layer-container';
        
        const animName = config.reverse ? 'discoSpinReverse' : 'discoSpin';
        layerDiv.style.animation = `${animName} ${config.duration}s linear infinite`;
        
        for (let i = 0; i < config.count; i++) {
            const spot = document.createElement('div');
            spot.className = 'disco-spot';

            // --- 位置 ---
            const angle = Math.random() * Math.PI * 2;
            const dist = random(config.radiusMin, config.radiusMax);
            const left = 50 + (Math.cos(angle) * dist) / 2; 
            const top = 50 + (Math.sin(angle) * dist) / 2;

            // --- 尺寸与形状 (去圆化) ---
            const w = config.sizeBase + Math.random() * 10;
            const normalizedDist = Math.min(dist / 140, 1);
            
            // 基础形状不再是正圆(1.0)，而是椭圆(1.5)
            // 越往外越拉长，最大拉伸到 3.0 倍 (之前太圆是因为这里太小)
            const baseElongation = 1.5; 
            const distanceStretch = normalizedDist * 1.5; 
            const curvature = baseElongation + distanceStretch;
            
            const h = w * curvature;

            // --- 颜色与透明度 ---
            const opacityBase = 0.9 - (normalizedDist * 0.4); // 中心实(0.9), 边缘虚(0.5)

            const isColored = Math.random() > 0.75; // 25% 概率是彩色
            let colorString;
            
            if (isColored) {
                const rgb = vividColorsRGB[Math.floor(Math.random() * vividColorsRGB.length)];
                colorString = `rgba(${rgb}, ${opacityBase * 0.9})`; 
            } else {
                colorString = `rgba(255, 255, 255, ${opacityBase})`;
            }

            // --- 样式应用 ---
            spot.style.width = w + 'px';
            spot.style.height = h + 'px';
            spot.style.left = left + '%';
            spot.style.top = top + '%';
            
            // 保持中心稍微实心一点 (20%)
            spot.style.background = `radial-gradient(ellipse at 50% 50%, ${colorString} 20%, rgba(0,0,0,0) 65%)`;
            
            // 旋转指向中心
            const rotation = (angle * 180) / Math.PI + 90;
            spot.style.transform = `translate(-50%, -50%) rotate(${rotation}deg)`;
            spot.style.filter = `blur(${config.blur}px)`;
            
            spot.style.animation = `discoPulse ${4 + Math.random() * 3}s ease-in-out infinite alternate`;
            spot.style.animationDelay = `${Math.random() * 5}s`;

            layerDiv.appendChild(spot);
        }

        root.appendChild(layerDiv);
    });
})();
</script>

{{ end }}